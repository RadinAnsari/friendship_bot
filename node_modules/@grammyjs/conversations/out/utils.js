"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.resolver = exports.IS_NOT_INTRINSIC = exports.clone = exports.ident = void 0;
const deps_node_js_1 = require("./deps.node.js");
/** Identity function */
function ident(arg) {
    return arg;
}
exports.ident = ident;
/**
 * Performs a structured clone, ignoring non-enumerable properties such as
 * functions.
 */
function clone(arg) {
    const list = (0, deps_node_js_1.listify)(arg);
    if (Array.isArray(list) && list.length === 0)
        return undefined;
    return (0, deps_node_js_1.delistify)(list);
}
exports.clone = clone;
// Define which context properties are intrinsic to grammY or this plugin and
// should not be stored in the op logs
const INTRINSIC_CONTEXT_PROPS = new Set([
    "update",
    "api",
    "me",
    "conversation",
]);
function IS_NOT_INTRINSIC(key) {
    return !INTRINSIC_CONTEXT_PROPS.has(key);
}
exports.IS_NOT_INTRINSIC = IS_NOT_INTRINSIC;
/** Creates a new resolver */
function resolver(value) {
    const rsr = { value, isResolved: () => false };
    rsr.promise = new Promise((resolve) => {
        rsr.resolve = (t = value) => {
            if (t === undefined)
                throw new Error("No resolve value given!");
            rsr.isResolved = () => true;
            rsr.value = t;
            resolve(t);
        };
    });
    return rsr;
}
exports.resolver = resolver;
